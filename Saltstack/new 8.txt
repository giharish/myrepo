Antivirus should be enabled and updated with latest signature, if ad is disabled then restart the services and send mail to a DL - Done
password policy check â€“ on win server - Done
fetch local users details using saltstack, for Linux host file entry, check users having root access, genuine change has to be done through salt and demonstrated - Done
Status on SNMP & WMI service, restart if it is not running - Done
HTTP & FTP has to be disabled, mail to be sent to security team
on servers dhcp clients has to be disabled - Done




Symantec Endpoint Notification Service
SEP Master Service
SEPlpsService
SepScanService
sepwscsvc
SepMasterService
SepScanSvc
sepWscSvc
1. DHCP Clients Disabled:
disable_dhcp:
  service.dead:
    - iphlpsvc
    - WinHttpAutoProxySvc
    - AppVClient
    - netprofm
    - NlaSvc
    - Dhcp
  - timeout: 180
  - enable: false
  
2. SNMP & WMI Service Running (Installed (if not) & Restart if not running)
SNMP_Install:
  win_servermanager.installed:
  - name: SNMP-Service
  - recurse: true
Restart_Service:
  service.running:
  - names: 
    - SNMP
    - Winmgmt
  - timeout: 180
  - enable: true
  - require:
    - win_servermanager: SNMP_Install

Beacon Config for SNMP: (snmp_beacon.sls)
#State file for applying a beacon state for the SNMP service
snmp_beacon: 
  beacon.present: 
    - name: service 
    - save: True  
    - enabled: True
    - services: 
        SNMP: 
          onchangeonly: True 

Reactor Config:(reactor.conf)
  - 'salt/beacon/*/service/SNMP':
    - salt://manipaldemo/snmp_react.sls

Reactor State File: (snmp_react.sls)
{%- if data[data['service_name']]['running'] == False %}
start {{data['service_name']}}:
  local.service.start:
  - tgt: {{data['id']}}
  - args:
    - name: {{data['service_name']}}
{%- endif %}

React to SNMP:
  local.state.apply:
    - tgt: {{ data['id'] }}
    - arg:
      - manipaldemo.snmp_wmi_enable
{%- if data[data['service_name']]['running'] == False %}
Send Email:
  local.smtp.send_msg:
    - tgt: {{ data['id'] }}
	- kwarg:
	    name:'This is a notification from beacon on the host: {{ data['id'] }}'. SNMP Service is stopped/disabled'
	    recipient: recipient@xyz.com
	    profile: my-smtp-config
	    subject: "SNMP Beacon Notification"
	    sender: sender@xyz.com
	    server: mailhost FQDN/IP
        use_ssl: False
		username:
		password:
	  
	  
3. FTP & HTTP Disable
apache:
  service.dead:
  {% if grains['os'] == 'RedHat'%}
  - name: httpd
  {% elif grains['os'] == 'CentOS'%}
  - name: httpd
  {% elif grains['os'] == 'Ubuntu'%}
  - name: apache2
  {% elif grains['os'] == 'Debian'%}
  - name: apache2
  {% endif %}
  - enable: False
ftp:
  service.dead:
  - name: vsftpd
  - enable: False

4. SMTP Configuration for Minions (/etc/salt/minion.d/smtp.conf)
my-smtp-config:
  smtp.server: mail.manipalhospitals.com
  smtp.tls: false
  smtp.sender: ashish.gupta@manipalhospitals.com
  smtp.username:
  smtp.password:

SMTP State File (smtp.sls)
/etc/salt/minion.d/smtp.conf:
  file.managed:
    - source:
      - salt://manipaldemo/files/minion.d/smtp.conf
    - makedirs: True
	
5. Password Policy Check:
password_policy_check:
  lgpo.set:
    - computer.policy:
        Maximum password age: 60
        Minimum password age: 1
        Minimum password length: 14
        Account lockout duration: 120
        Account lockout threshold: 10
        Reset account lockout counter after: 120
        Manage auditing and security log:
          - "BUILTIN\\Administrators"
        Replace a process level token:
          - "NT AUTHORITY\\NETWORK SERVICE"
          - "NT AUTHORITY\\LOCAL SERVICE"
        "Accounts: Guest account status": Disabled
        "Accounts: Rename guest account": Not_4_U
        "Audit: Audit the use of Backup and Restore privilege": Enabled
        "Interactive logon: Do not display last user name": Enabled
        "Network\\DNS Client\\Dynamic update": Disabled
        "System\\Logon\\Do not display the Getting Started welcome screen at logon": Enabled
        "Windows Components\\Remote Desktop Services\\Remote Desktop Session Host\\Connections\\Select RDP transport protocols":
            "Select Transport Type": "Use both UDP and TCP"
        "Windows Components\\Windows Update\\Allow Automatic Updates immediate installation": Enabled
        "Windows Components\\Windows Update\\Allow non-administrators to receive update notifications": Disabled
        "Windows Components\\Windows Update\\Always automatically restart at the scheduled time":
            "The restart timer will give users this much time to save their work (minutes)": 15
        "Windows Components\\Windows Update\\Automatic Updates detection frequency":
            "Check for updates at the following interval (hours)": 1
        "Windows Components\\Windows Update\\Configure Automatic Updates":
            "Configure automatic updating": 4 - Auto download and schedule the install
            "Install during automatic maintenance": False
            "Scheduled install day": 7 - Every Saturday
            "Scheduled install time": "17:00"
        "Windows Components\\Windows Update\\Delay Restart for scheduled installations":
            "Wait the following period before proceeding with a scheduled restart (minutes)": 1
        "Windows Components\\Windows Update\\No auto-restart with logged on users for scheduled automatic updates installations": Disabled
        "Windows Components\\Windows Update\\Re-prompt for restart with scheduled installations":
            "Wait the following period before prompting again with a scheduled restart (minutes)": 30
        "Windows Components\\Windows Update\\Reschedule Automatic Updates scheduled installations": Disabled
        "Windows Components\\Windows Update\\Specify intranet Microsoft update service location":
            "Set the intranet update service for detecting updates": http://mywsus
            "Set the intranet statistics server": http://mywsus
    - cumulative_rights_assignments: True
CN=demo user,OU=VBCExtUsers,DC=vmwext,DC=in - Demo Username
OU=Testing,DC=vmwext,DC=in
	
Master Install
sudo apt-get update 
sudo apt-get install python3.7
curl -L https://bootstrap.saltstack.com -o install_salt.sh
sudo sh install_salt.sh -P -M -N
sudo vim /etc/salt/master
Edit the following entry in the file
interface: 192.168.50.2
sudo systemctl restart salt-master

Minions
sudo apt-get update 
sudo apt-get install python3.7
curl -L https://bootstrap.saltstack.com -o install_salt.sh
sudo sh install_salt.sh -A 172.16.39.21
Edit the following entry in the file
sudo vim /etc/salt/minion
master: 192.168.50.2
sudo systemctl restart salt-minion

Username :ubenjamin@onevmw.onmicrosoft.com 
Password:  0c14f5e6a0d22c50176b

sudo yum install https://repo.saltstack.com/py3/redhat/salt-py3-repo-latest.el7.noarch.rpm
sudo yum install salt-master
sudo yum install salt-minion
error creating RDS cluster: DBSubnetGroupNotFoundFault: DB subnet group 'subnet-4d7e8f26' does not exist. status code: 404, request id: 5b3c8e2c-3497-42c8-b1f0-756a01abdda0

{% if grains.os == 'CentOS' %}
    configure_sshd:
        file.managed:
        - name: /etc/ssh/sshd_config
        - source: salt://mod4/sshd_config
        - makedirs: True

    reload_sshd:
        service.running:
        - name: sshd
        - enable: True
        - reload: True
        - watch:
            - configure_sshd
{% endif %}

beacons:
    files_to_watch:
        - files:
            /etc/hosts:
                mask:
                    - modify
                    - delete
                    - delete_self
                    - moved_from
            /etc/ssh/sshd_config:
                mask:
                    - modify
                    - delete
                    - delete_self
                    - moved_from
        - beacon_module: inotify
        - disable_during_state_run: True
		
		
reactor:
  - 'salt/beacon/*/files_to_watch//etc/ssh/sshd_config':
    - salt://mod4/reactors/sshd_remediate.sls?saltenv=sse

revert-file:
  local.state.apply:
    - tgt: {{ data['id'] }}
    - arg:
      - hol.mod4.sshd
	  - saltenv=sse
	  
check_bits:
  service.running:
    - name: exactname_of_bits_service
    - enable: True
	
Runner Configurations:
salt-run manage.status

salt-run manage.down removekeys=True  (Removes Key of all minions that are down)

Pushing a Application and Files related to it
dns_install:
  pkg.installed:
    - name: bind

dns_service:
  service.running:
    - name: named
    - enable: True

dns_conf:
  file.managed:
    - name: /etc/named.conf
    - source: salt://dns/files/named.conf
    - require:
      - pkg: dns_install

Creating User and Group
create_user:
  user.present:
    - name: bind
    - require:
    - pkg: dns_install

create_group:
 group.present:
   - name: bind
   - require:
   - pkg: dns_install

#/ssh/init.sls
install_ssh:
  pkg.latest:
    - name: openssh

ssh_server:
  service.running:
    - name: sshd
    - enable: True
    - watch:
      - pkg: install_ssh
    - file: sshd_conf

sshd_conf:
  file.managed:
    - name: /etc/ssh/sshd_config
    - source: salt://ssh/files/sshd_config
	
#/ssh/config.sls
include:
  - ssh

extend:
  sshd_conf:
    file:
      - name: /etc/ssh/sshd_config
      - source: salt://ssh/files/dmz_sshd_config

  ssh_server:
    service:
      - watch:
        - file: add_banner

add_banner:
  file.managed:
    - name: /etc/ssh/banner
    - source: salt:/ssh/files/banner

#MySQL DB Creation	
create_db_user:
  mysql_user.present:
    - name: jdoe
    - host: localhost
    - password: p@ssw0rd
    - onlyif:
      - mysql -u ro_user -e 'use projectDB'
	  
#Listen Criteria
restart_apache2:
  service.running:
    - name: apache2
    - listen:
      - file: /etc/apache2/apache2.conf

configure_apache2:
  file.managed:
    - name: /etc/apache2/apache2.conf
    - source: salt://apache2/apache2.conf
	
copy-liagent-rpm:
   cmd.run:
      - name: sudo curl -k http://webserver/LIAgent/VMware-Log-Insight-Agent-8.2.0-16776561.rpm --output /tmp/VMware-Log-Insight-Agent-8.2.0-16776561.rpm
install-liagent:
   cmd.run:
      - name: sudo rpm -i /tmp/VMware-Log-Insight-Agent-8.2.0-16776561.rpm
copy-liagentconfig:
   cmd.run:
      - name: sudo curl -k http://webserver/LIAgent/liagent.ini --output /var/lib/loginsight-agent/liagent.ini
restart-liagentd:
   cmd.run:
      - name: sudo systemctl restart liagentd   
	  

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate]
"ElevateNonAdmins"=dword:00000001
"WUServer"="http://x.x.x.x:8530"
"WUStatusServer"="http://x.x.x.x6:8530"

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU]
"NoAutoUpdate"=dword:00000000
"AUOptions"=dword:00000003
"ScheduledInstallDay"=dword:00000000
"ScheduledInstallTime"=dword:0000000f
"AutoInstallMinorUpdates"=dword:00000001
"UseWUServer"=dword:00000001